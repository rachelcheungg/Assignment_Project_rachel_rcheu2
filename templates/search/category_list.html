{% extends "base.html" %}

{% block title %}SaleMate{% endblock %}
{% block header %}Category List{% endblock %}

{% block send_search %}
    <form method="get">
       <div class="row g-2 align-items-center">
        <input type="text" name="q" class="form-control mb-3" placeholder="Search for a category">
       </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">Search</button>
            {% if q %}<a class="btn btn-outline-secondary ms-2" href="{% url 'categories-list-url' %}">Clear</a>{% endif %}
        </div>
    </form>
{% endblock %}

{% block filter %}
  {% if q %}
    <p class="text-muted mt-3 mb-2">result for “{{ q }}”</p>
    <div class="card">
      <ul class="list-group list-group-flush">
        {% for category_item in search_results %}
          <li class="list-group-item">
            <a>{{ category_item.category_name }}</a>
          </li>
        {% empty %}
          <li class="list-group-item text-muted"><em>No categories found.</em></li>
        {% endfor %}
      </ul>
    </div>
  {% else %}
    <p class="text-muted mt-3">All categories</p>
  {% endif %}
{% endblock %}

{% block content %}
<h2>Categories</h2>
<ul>
    {% for category_for_loop in category_list %}
        <li>
            <a href=""> {{ category_for_loop }}</a>
        </li>
    {% empty %}
        <li>No categories yet!</li>
    {% endfor %}
</ul>

<h2>Category Summary</h2>

<p><strong>Total websites:</strong> {{ total_websites }}</p>

<h3>Number of websites per category</h3>
<ul>
  {% for category in websites_per_category %}
    <li>{{ category.category_name }}: {{ category.n_websites }} website{% if category.n_websites != 1 %}s{% endif %}</li>
  {% empty %}
    <li>No categories or websites yet!</li>
  {% endfor %}
</ul>

  <div class="card mt-3">
    <div class="card-header py-2"><strong>Bar Chart: Websites per Category</strong></div>
    <div class="card-body text-center">

        <!-- Here, using the 'url' tag, I'm directly referencing the chart projected at a url -->
      <img src="{% url 'chart-categories' %}" alt="Websites per category chart"
           class="img-fluid" style="max-width: 480px;">
      <p class="mt-2 text-muted small">
        Each bar represents how many websites belong to a given category.
      </p>
    </div>
  </div>

<h3>Total Websites</h3>
<img src="{% url 'chart-total-websites' %}" alt="Total websites chart" class="img-fluid" style="max-width:300px;">
<p class="mt-2 text-muted small">
    This chart shows the overall total number of websites stored in the system.
</p>

{% endblock %}